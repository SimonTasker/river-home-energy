# Home Energy Online ML

--- WIP ---

Online Machine Learning of Home Energy usage, using River ML.

Uses MQTT feeds, currently from Tasmota power monitoring devices, to learn energy usage patterns, and provide energy usage predictions.

Provides predictions back to MQTT interface.

TODO: A GRPC interface is in development to allow API control of the machine learning model while it is continually running.

# Getting Started

## Configuration
Primarily the application is configured through a configuration file, which the application by default looks for within `./configuration.ini`.

The default configuration file can be automatically generated using the `tools/generate_config.py` script.

The application can also be configured via a command line interface:

```bash
$ python home_energy.py -h
usage: Home Energy [-h] [-c CONFIGURATION] [-d DATA_DIR]

Connects to a Tasmota MQTT feed, learns usage, and provides predictions

optional arguments:
  -h, --help            show this help message and exit
  -c CONFIGURATION, --configuration CONFIGURATION
                        Application Configuration File. (Default: configuration.ini)
  -d DATA_DIR, --data_dir DATA_DIR
                        Application Data Directory. (Default: /data)
```

The only purpose of the CLI is to change the primary configuration file, and to set the data directory the application will use to read the configuration file from and output log files to.

An example predictor running on a Raspberry Pi, being use to predict kettle usage, can be found [here](https://github.com/SimonTasker/kettle-predictor)

## Logging
The Application provides two logging interfaces. Console and File.\
INFO level logging will be printed to the console.\
DEBUG level logging will be saved to a log file. The file will be saved in the specified data directory, with filename `<application_name>.log`

## gRPC (NOT USED YET)
The generated python code is provided as part of this repository, however can be regenerated by:

```bash
# Ensure you have grpcio tools installed
$ pip install grpcio-tools

# Then generate
$ python -m grpc_tools.protoc -I ./protos --python_out=. --pyi_out=. --grpc_python_out=. ./protos/control.proto
```